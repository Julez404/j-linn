name: Deploy

on:
  push:
    branches: [ master ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: archive repository
      run: zip -r archive.zip .
    - name: copy folder content recursively to remote (clean directory)
      uses: garygrossgarten/github-action-scp@release
      with:
        local: /home/runner/work/j-linn/j-linn/archive.zip
        remote: /var/www/j-linn.de/
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        privateKey: ${{ secrets.KEY}}
        port: ${{ secrets.PORT}}
        rmRemote: true
        dotfiles: false
    - name: unzip and remove archive
      uses: garygrossgarten/github-action-ssh@release
      with:
        command: >-
          cd /var/www/j-linn.de/ &&
          unzip archive.zip &&
          rm archive.zip
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        privateKey: ${{ secrets.KEY }}
        port: ${{ secrets.PORT}}
